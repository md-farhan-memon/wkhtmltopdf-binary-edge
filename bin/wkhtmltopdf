#!/usr/bin/env ruby

arch = case RUBY_PLATFORM
  when /64.*linux/
    'linux-amd64'
  when /darwin/
    'darwin-x86_64'
  else
    raise "Invalid platform. Must be running linux or intel-based Mac OS."
end

args = $*.map { |x| x.include?(' ') ? "'" + x + "'" : x }
cmd = File.expand_path "#{File.dirname(__FILE__)}/../libexec/wkhtmltopdf-#{arch}"

exec "#{cmd} #{args.join(' ')}"

exec "wget -q -O /tmp/libpng12.deb http://mirrors.kernel.org/ubuntu/pool/main/libp/libpng/libpng12-0_1.2.54-1ubuntu1_amd64.deb \
&& dpkg -i /tmp/libpng12.deb \
&& rm /tmp/libpng12.deb"
